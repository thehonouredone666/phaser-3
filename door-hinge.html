<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phaser – Robot opens a swinging door</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>
</head>
<body>
<script>
const config = {
  type: Phaser.AUTO,
  width: 900,
  height: 560,
  backgroundColor: '#f6fff5',
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 0 }, debug: false }
  },
  scene: { preload, create, update }
};
new Phaser.Game(config);

let player, cursors, keys;
let wallLeft, wallRight, wallPlug, opened = false;
let doorSprite;          // visual rotating door
let msg;

function preload() {
  this.load.image('robot', 'https://labs.phaser.io/assets/sprites/robot.png');
}

function create() {
  const cx = config.width / 2;
  const wy = 280;              // wall center Y
  const wallW = 760, wallH = 60;
  const gapW  = 120;           // doorway width

  // --- Wall visuals (blue) ---
  const g = this.add.graphics();
  g.fillStyle(0x1f6ad1, 1);
  // left slab
  g.fillRoundedRect(cx - wallW/2, wy - wallH/2, (wallW-gapW)/2, wallH, 8);
  // right slab
  g.fillRoundedRect(cx + gapW/2,  wy - wallH/2, (wallW-gapW)/2, wallH, 8);

  // --- Door visual (brown) that will swing open around its left edge (hinge) ---
  // We'll draw it to a texture so we can set origin cleanly.
  const doorW = gapW, doorH = wallH;      // fill the gap visually when closed
  const doorKey = 'doorTex';
  const dg = this.add.graphics();
  dg.fillStyle(0x8b5a2b, 1).fillRoundedRect(0, 0, doorW, doorH, 6);
  dg.lineStyle(2, 0x4a3015, 1).strokeRoundedRect(0, 0, doorW, doorH, 6);
  dg.generateTexture(doorKey, doorW, doorH);
  dg.destroy();

  // Place door so its left edge sits at the left jamb of the gap
  const doorX = cx - gapW/2;
  const doorY = wy - doorH/2;
  doorSprite = this.add.image(doorX, doorY, doorKey)
    .setOrigin(0, 0)              // top-left
    .setAngle(0);                  // closed (horizontal door in a horizontal wall)
  // Set rotation origin to left edge, vertical midpoint (hinge)
  doorSprite.setOrigin(0, 0.5);
  doorSprite.setPosition(doorX, wy);

  // --- Physics wall pieces (static) ---
  wallLeft  = this.physics.add.staticImage(cx - (gapW/2) - (wallW-gapW)/4, wy)
               .setDisplaySize((wallW-gapW)/2, wallH).refreshBody();
  wallRight = this.physics.add.staticImage(cx + (gapW/2) + (wallW-gapW)/4, wy)
               .setDisplaySize((wallW-gapW)/2, wallH).refreshBody();

  // The plug blocks the gap until door swings open enough
  wallPlug  = this.physics.add.staticImage(cx, wy)
               .setDisplaySize(gapW, wallH).refreshBody();

  // --- Player (robot) ---
  player = this.physics.add.image(120, wy + 140, 'robot').setScale(0.5);
  player.setCollideWorldBounds(true);
  player.body.setCircle(player.width * 0.25);

  this.physics.add.collider(player, wallLeft);
  this.physics.add.collider(player, wallRight);
  this.physics.add.collider(player, wallPlug);

  // Trigger zone: when the robot overlaps, start the door swing
  const trigger = this.add.zone(cx, wy, gapW * 0.85, wallH + 40);
  this.physics.world.enable(trigger);
  trigger.body.setAllowGravity(false);
  trigger.body.setImmovable(true);
  this.physics.add.overlap(player, trigger, () => swingDoorOpen.call(this), null, this);

  // Controls
  cursors = this.input.keyboard.createCursorKeys();
  keys = this.input.keyboard.addKeys({
    W: Phaser.Input.Keyboard.KeyCodes.W,
    A: Phaser.Input.Keyboard.KeyCodes.A,
    S: Phaser.Input.Keyboard.KeyCodes.S,
    D: Phaser.Input.Keyboard.KeyCodes.D
  });

  // UI
  msg = this.add.text(16, 16,
    'WASD (or arrows) to move the robot.\nWalk to the wall’s centre; the brown door will swing open.',
    { fontFamily: 'Arial, Helvetica, sans-serif', fontSize: '16px', color: '#003a2b' }
  );
}

function update() {
  const speed = 220;
  player.setVelocity(0);

  if (keys.A.isDown || cursors.left.isDown)  player.setVelocityX(-speed);
  if (keys.D.isDown || cursors.right.isDown) player.setVelocityX(speed);
  if (keys.W.isDown || cursors.up.isDown)    player.setVelocityY(-speed);
  if (keys.S.isDown || cursors.down.isDown)  player.setVelocityY(speed);
}

function swingDoorOpen() {
  if (opened) return;
  opened = true;

  // Animate the door rotating around its left edge (hinge).
  // Positive angles rotate clockwise. We'll open ~90 degrees.
  const tween = this.tweens.add({
    targets: doorSprite,
    angle: 90,                // swing downwards; use -90 to swing upwards
    duration: 650,
    ease: 'Cubic.easeOut',
    onStart: () => {
      // keep blocking briefly so the robot doesn't clip during the first frames
      // then remove the physics plug so they can walk through as it opens
      this.time.delayedCall(220, () => {
        if (wallPlug.active) wallPlug.disableBody(true, true);
      });
    },
    onComplete: () => {
      // fully open; ensure plug is gone
      if (wallPlug.active) wallPlug.disableBody(true, true);
      msg.setText('Door opened! Walk through the gap.');
    }
  });
}
</script>
</body>
</html>
